
# ðŸš€ COMANDOS COMPLETOS PARA CONFIGURAÃ‡ÃƒO BACKEND2

## ðŸ“¦ 1. INSTALAÃ‡ÃƒO INICIAL

# Navegar para pasta backend2
cd backend2

# Instalar todas as dependÃªncias
npm install express prisma @prisma/client pg dotenv cors multer bcryptjs jsonwebtoken nodemon

## ðŸ—„ï¸ 2. CONFIGURAÃ‡ÃƒO DO BANCO

# Gerar cliente Prisma
npx prisma generate

# Aplicar schema ao banco PostgreSQL
npx prisma db push

# Verificar configuraÃ§Ã£o do banco
node scripts/setup-database.js

## ðŸ”„ 3. MIGRAÃ‡ÃƒO DE DADOS

# Colocar arquivo cipex.sql na pasta backend/
# cp /caminho/para/cipex.sql ../backend/

# Executar migraÃ§Ã£o dos dados
node scripts/migrate-sql.js

## ðŸ” 4. VERIFICAÃ‡ÃƒO

# Abrir interface visual do banco
npx prisma studio

# Testar conexÃ£o com banco
node -e "const {prisma} = require('./lib/database'); prisma.usuario.count().then(count => console.log('UsuÃ¡rios:', count)).finally(() => prisma.$disconnect())"

## ðŸ–¥ï¸ 5. EXECUTAR SERVIDOR

# Modo desenvolvimento (recarrega automaticamente)
npm run dev

# Modo produÃ§Ã£o
npm start

## ðŸ§ª 6. TESTAR API

# Testar se servidor estÃ¡ rodando
curl http://localhost:5000/usuarios

# Testar login (substitua email/senha por dados reais)
curl -X POST http://localhost:5000/login \
  -H "Content-Type: application/json" \
  -d '{"cp_email_usuario":"admin@exemplo.com","cp_senha_usuario":"senha123"}'

# Testar criaÃ§Ã£o de usuÃ¡rio
curl -X POST http://localhost:5000/usuarios \
  -H "Content-Type: application/json" \
  -d '{"cp_nome_usuario":"Teste","cp_email_usuario":"teste@teste.com","cp_senha_usuario":"123456","cp_tipo_usuario":"aluno"}'

## ðŸ”§ 7. COMANDOS DE MANUTENÃ‡ÃƒO

# Resetar banco (CUIDADO: apaga todos os dados)
npx prisma db push --force-reset

# Visualizar logs do Prisma
npx prisma db push --preview-feature

# Verificar status do banco
npx prisma db push --dry-run

# Gerar nova migraÃ§Ã£o
npx prisma migrate dev --name adicionar_nova_tabela

## ðŸ“Š 8. COMANDOS DE MONITORAMENTO

# Ver processos rodando na porta 5000
lsof -i :5000

# Matar processo na porta 5000
pkill -f "node.*5000"

# Ver logs em tempo real
tail -f logs/app.log

# Verificar uso de memÃ³ria
ps aux | grep node

## ðŸ—ƒï¸ 9. COMANDOS DO BANCO DE DADOS

# Conectar ao PostgreSQL via psql (se disponÃ­vel)
psql $DATABASE_URL

# Comandos SQL Ãºteis:
# SELECT COUNT(*) FROM usuarios;
# SELECT * FROM usuarios LIMIT 5;
# SELECT COUNT(*) FROM matriculas;

## ðŸ”„ 10. SCRIPTS NPM DISPONÃVEIS

npm start              # Iniciar servidor produÃ§Ã£o
npm run dev            # Iniciar servidor desenvolvimento
npm run db:generate    # Gerar cliente Prisma
npm run db:push        # Aplicar schema
npm run db:migrate     # Criar migraÃ§Ã£o
npm run db:studio      # Interface visual
npm run db:setup       # Configurar banco
npm run db:migrate-sql # Migrar dados SQL

## ðŸš¨ 11. SOLUÃ‡ÃƒO DE PROBLEMAS

# Erro "Prisma Client is not generated"
npx prisma generate

# Erro "Can't connect to database"
echo $DATABASE_URL
node scripts/setup-database.js

# Erro "Port already in use"
pkill -f "node.*5000"
npm run dev

# Erro na migraÃ§Ã£o SQL
# 1. Verificar se cipex.sql estÃ¡ em backend/
# 2. Verificar formato do arquivo SQL
# 3. Executar: npm run db:push --force-reset
# 4. Executar: npm run db:migrate-sql

# Reinstalar dependÃªncias
rm -rf node_modules package-lock.json
npm install

## ðŸ“‹ 12. CHECKLIST DE VERIFICAÃ‡ÃƒO

â–¡ PostgreSQL configurado no Replit
â–¡ Arquivo .env com DATABASE_URL
â–¡ DependÃªncias instaladas (npm install)
â–¡ Cliente Prisma gerado (npx prisma generate)
â–¡ Schema aplicado (npx prisma db push)
â–¡ Arquivo cipex.sql na pasta backend/
â–¡ MigraÃ§Ã£o executada (npm run db:migrate-sql)
â–¡ Servidor iniciado (npm run dev)
â–¡ API testada (curl localhost:5000/usuarios)

## ðŸŽ¯ 13. COMANDOS PARA PRODUÃ‡ÃƒO

# Build para produÃ§Ã£o
npm install --production

# Iniciar com PM2 (se disponÃ­vel)
pm2 start index.js --name backend2

# Verificar logs produÃ§Ã£o
pm2 logs backend2

# Reiniciar aplicaÃ§Ã£o
pm2 restart backend2

## ðŸ“ 14. COMANDOS DE BACKUP

# Backup do banco PostgreSQL
pg_dump $DATABASE_URL > backup_$(date +%Y%m%d_%H%M%S).sql

# Restaurar backup
psql $DATABASE_URL < backup_20240108_143000.sql

# Exportar dados especÃ­ficos
npx prisma db export --output-dir ./exports

## ðŸ” 15. COMANDOS DE DEBUG

# Verificar versÃµes
node --version
npm --version
npx prisma --version

# Verificar configuraÃ§Ã£o Prisma
npx prisma validate

# Ver informaÃ§Ãµes detalhadas do banco
npx prisma db push --preview-feature

# Logs detalhados do servidor
DEBUG=* npm run dev

## âš¡ 16. COMANDOS RÃPIDOS

# Setup completo em uma linha
cd backend2 && npm install && npx prisma generate && npx prisma db push && npm run db:migrate-sql && npm run dev

# VerificaÃ§Ã£o rÃ¡pida
curl -s http://localhost:5000/usuarios | head -50

# Reset completo
npx prisma db push --force-reset && npm run db:migrate-sql

# Parar tudo
pkill -f "node.*5000"
